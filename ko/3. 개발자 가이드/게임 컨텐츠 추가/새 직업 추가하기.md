# 새 직업 추가하기

## 개요

메이플 듀얼에서 새로운 직업 클래스를 추가하는 과정을 단계별로 설명합니다. 새 직업을 추가하면 해당 직업 전용 카드들과 기본 덱이 자동으로 구성되며, AI 봇도 함께 추가됩니다.

## 1단계: 데이터 정의

### Card.csv에 새 직업 카드 추가
```csv
name,category,job,rarity,cost,hp,atk,description,frontRUID,backRUID,soundRUID,triggerNameArray,auraNameArray
SamuraiSlash,Skill,Samurai,Common,3,0,0,사무라이의 검기로 적을 벤다,samurai_slash_front,common_back,slash_sound,"SamuraiSlash",""
```

**주요 설정:**
- `job`: 새 직업명 (예: `Samurai`)
- `category`: 카드 타입 (`Minion`, `Skill`)
- `rarity`: 희귀도 설정
- `triggerNameArray`: 카드 효과 트리거명

### 직업별 기본 카드 세트 정의
```lua
-- 새 직업의 기본 카드 구성
local SAMURAI_BASE_CARDS = {
    {name = "SamuraiSlash", count = 2},
    {name = "BushidoSpirit", count = 1}, 
    {name = "KatanaStrike", count = 2},
    {name = "SamuraiGuard", count = 1}
}
```

## 2단계: DeckManager 확장

### 새 직업을 덱 시스템에 등록
```lua
-- DeckManager.mlua 확장
@ExecSpace("ServerOnly")
method void OnBeginPlay()
    __base:OnBeginPlay()
    
    -- 기존 직업들
    self.validJobs = {"Warrior", "Magician", "Bowman", "Thief", "Pirate", "Samurai"}
    
    -- 새 직업의 기본 덱 구성
    self.defaultDecks["Samurai"] = {
        -- 공통 카드 12장
        {name = "MiniMushroom", count = 2},
        {name = "Snail", count = 2},
        -- ... 기타 공통 카드들
        
        -- 사무라이 전용 카드 8장  
        {name = "SamuraiSlash", count = 2},
        {name = "KatanaStrike", count = 2},
        {name = "BushidoSpirit", count = 1},
        {name = "SamuraiGuard", count = 1},
        {name = "DragonSlayer", count = 1},
        {name = "Meditate", count = 1}
    }
end
```

### 덱 유효성 검사 확장
```lua
method boolean IsValidJobForDeck(string job, table cards)
    if job == "Samurai" then
        -- 사무라이 전용 검증 로직
        return self:ValidateSamuraiDeck(cards)
    end
    
    -- 기존 직업 검증...
end

method boolean ValidateSamuraiDeck(table cards)
    local samuraiCardCount = 0
    
    for _, card in ipairs(cards) do
        local cardData = self.cardManager:GetCardData(card.name)
        if cardData and cardData.job == "Samurai" then
            samuraiCardCount += card.count or 1
        end
    end
    
    -- 사무라이 카드가 최소 6장, 최대 10장
    return samuraiCardCount >= 6 and samuraiCardCount <= 10
end
```

## 3단계: BotManager에 새 직업 봇 추가

### 봇 데이터 확장
```lua
-- BotManager.mlua에 새 직업 봇 추가
@ExecSpace("ServerOnly") 
method void OnBeginPlay()
    __base:OnBeginPlay()
    
    -- 기존 봇들...
    self:AddBot("SamuraiBotEasy", {
        name = "사무라이 수련생",
        job = "Samurai", 
        level = 1,
        difficulty = "Easy",
        deck = self:CreateSamuraiDeck("Easy")
    })
    
    self:AddBot("SamuraiBotHard", {
        name = "사무라이 마스터",
        job = "Samurai",
        level = 10, 
        difficulty = "Hard",
        deck = self:CreateSamuraiDeck("Hard")
    })
end

method table CreateSamuraiDeck(string difficulty)
    local baseDeck = self.deckManager.defaultDecks["Samurai"]
    
    if difficulty == "Hard" then
        -- 어려운 봇은 더 강력한 카드 사용
        baseDeck = self:UpgradeDeckToLegendary(baseDeck)
    end
    
    return baseDeck
end
```

### AI 전략 패턴 정의
```lua
-- ScoreManager.mlua에 사무라이 AI 패턴 추가
method number CalculateSamuraiPlayScore(Card card, Player bot, Player enemy)
    local score = 0
    
    -- 사무라이 직업 특성: 연속 공격 선호
    if card.name == "SamuraiSlash" then
        -- 적의 HP가 낮을 때 높은 점수
        if enemy.hp <= 15 then
            score += 30
        end
        
        -- 연속 스킬 콤보 가능하면 점수 증가
        if self:CanComboWith(bot, "KatanaStrike") then
            score += 20
        end
    end
    
    return score
end
```

## 4단계: 카드 효과 구현

### TriggerManager에 새 직업 트리거 추가
```lua
-- TriggerManager.mlua 확장
method boolean SamuraiSlashCondition(string triggerKey, Card invoker, Card receiver)
    -- 사무라이 슬래시: 적 미니언 대상
    return triggerKey == "PlaySkill" and receiver.job ~= invoker.job
end

method void SamuraiSlashAction(string triggerKey, Card invoker, Card receiver, table args)
    local damage = 4 + (invoker:GetBonusAttack() or 0)
    
    -- 연속 공격 효과: 이전 턴에 사무라이 스킬을 썼다면 추가 데미지
    if self:WasSamuraiSkillUsedLastTurn(invoker:GetPlayer()) then
        damage += 2
        _Effect:PlaySkillEffect("SamuraiCombo", receiver.minionActor.Entity)
    end
    
    receiver:TakeDamage(damage, invoker)
end

method boolean WasSamuraiSkillUsedLastTurn(Player player)
    -- 이전 턴 기록 확인
    local lastActions = player:GetLastTurnActions()
    for _, action in ipairs(lastActions) do
        if action.type == "PlaySkill" and action.card.job == "Samurai" then
            return true
        end
    end
    return false
end
```

## 5단계: UI 업데이트

### 캐릭터 선택 UI에 새 직업 추가
```lua
-- Character.mlua 확장
method table GetAvailableJobs()
    return {
        {name = "전사", job = "Warrior", icon = "warrior_icon"},
        {name = "마법사", job = "Magician", icon = "magician_icon"}, 
        {name = "궁수", job = "Bowman", icon = "bowman_icon"},
        {name = "도적", job = "Thief", icon = "thief_icon"},
        {name = "해적", job = "Pirate", icon = "pirate_icon"},
        {name = "사무라이", job = "Samurai", icon = "samurai_icon"} -- 새 추가
    }
end
```

### 덱 편집 UI에서 새 직업 카드 필터링
```lua
-- DeckEditPanel.mlua 확장  
method table FilterCardsByJob(string selectedJob)
    local availableCards = {}
    
    for _, cardData in ipairs(self.cardManager.dataSet:GetAllRows()) do
        -- 공통 카드는 모든 직업에서 사용 가능
        if cardData.job == "Common" or cardData.job == selectedJob then
            table.insert(availableCards, cardData)
        end
    end
    
    return availableCards
end
```

## 6단계: 리소스 추가

### 시각적 리소스
- **카드 아트워크**: 새 직업 카드의 전면 이미지
- **직업 아이콘**: UI에서 표시할 직업 상징 아이콘  
- **스킬 이펙트**: 새 직업 스킬의 시각 효과
- **사운드**: 새 직업 스킬 전용 사운드 이펙트

### 리소스 등록
```lua
-- ResourceManager.mlua에서 새 리소스 등록
local SAMURAI_RESOURCES = {
    icons = {
        samurai_icon = "SamuraiIcon.png"
    },
    effects = {
        samurai_slash = "SamuraiSlash.effect",
        bushido_spirit = "BushidoSpirit.effect"
    },
    sounds = {
        katana_strike = "KatanaStrike.wav",
        meditate = "Meditate.wav"
    }
}
```

## 7단계: 밸런스 조정

### 새 직업의 게임 밸런스 검토
```lua
-- 사무라이 직업 특성 정의
local SAMURAI_TRAITS = {
    strengths = {
        "연속 공격 콤보",
        "순간 폭딜", 
        "기동성"
    },
    weaknesses = {
        "방어력 부족",
        "마나 소모 큰 편",
        "원거리 공격 취약"
    },
    playstyle = "공격적 템포 덱"
}
```

### 카드 파워 레벨 조정
```lua
method void BalanceSamuraiCards()
    -- 기존 직업 대비 승률이 50% 근처가 되도록 조정
    local samuraiWinRate = self:CalculateJobWinRate("Samurai")
    
    if samuraiWinRate > 55 then
        self:NerfSamuraiCards() -- 너프
    elseif samuraiWinRate < 45 then  
        self:BuffSamuraiCards() -- 버프
    end
end
```

## 8단계: 테스트

### 새 직업 기능 테스트
```lua
function TestSamuraiJob()
    -- 덱 생성 테스트
    local deck = CreateSamuraiDeck()
    assert(IsValidDeck(deck, "Samurai"))
    
    -- 봇 대전 테스트  
    local samuraiBot = CreateBot("Samurai", "Easy")
    local testResult = SimulateDuel(samuraiBot, CreateBot("Warrior", "Easy"))
    
    -- 카드 효과 테스트
    TestSamuraiSkillEffects()
    
    log("사무라이 직업 테스트 완료")
end
```

## 완료 체크리스트

- [ ] Card.csv에 새 직업 카드 데이터 추가
- [ ] DeckManager에 새 직업 등록 및 기본 덱 정의
- [ ] BotManager에 새 직업 봇 추가
- [ ] TriggerManager에 새 직업 카드 효과 구현  
- [ ] UI에서 새 직업 선택 가능하도록 수정
- [ ] 새 직업 관련 리소스(아트, 사운드, 이펙트) 추가
- [ ] 게임 밸런스 테스트 및 조정
- [ ] 모든 기능에 대한 통합 테스트 완료

## 참고 자료

- `1. 핵심 아키텍처/덱 시스템/덱 관리 시스템.md` - 덱 시스템 상세 설명
- `1. 핵심 아키텍처/AI/봇 시스템/봇 데이터 관리.md` - 봇 시스템 관리
- `3. 개발자 가이드/게임 컨텐츠 추가/새 카드 추가하기.md` - 카드 추가 방법

새 직업 추가는 복잡한 작업이지만 이 가이드를 따르면 체계적이고 안정적으로 새로운 직업을 게임에 통합할 수 있습니다.
