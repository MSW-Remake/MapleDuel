# 새 카드 추가하기

## 개요

메이플 듀얼에 새로운 카드를 추가하는 것은 데이터 입력, 시각적 리소스 준비, 게임 로직 구현, 테스트 등 여러 단계를 거쳐야 합니다. 이 가이드는 새로운 카드를 게임에 성공적으로 추가하는 전체 과정을 단계별로 설명합니다.

## 1단계: 카드 기획 및 설계

### 카드 스펙 정의

새 카드를 추가하기 전에 먼저 카드의 기본 스펙을 정의해야 합니다.

**필수 정보:**
```
카드명: 예) "FireBolt"
카테고리: Skill 또는 Minion
직업: Warrior, Magician, Bowman, Thief, Pirate, Common
테마: Classic, Nautilus 등
희귀도: Normal, Rare, Epic, Unique, Legendary
비용: 0~10 MP
효과: 구체적인 게임 효과 설명
```

**미니언 카드 추가 정보:**
```
최대 체력: 1~10
공격력: 0~10
특수 상태: 방어막, 독, 빙결 여부
```

**스킬 카드 추가 정보:**
```
타겟 필요 여부: 타겟 지정 스킬인지 여부
```

## 2단계: Card.csv 데이터 입력

### 데이터 구조 이해

`RootDesk/MyDesk/DataSets/Card.csv` 파일에 새 카드 정보를 추가합니다.

**주요 필드 설명:**
```csv
name,category,class,theme,rarity,isToken,tagArray,variantArray,linkArray,cost,maxHp,atk,hasBarrier,hasVenom,hasChill,isDirectAttackable,isImmuneToStrong,cardTriggerNameArray,cardAuraNameArray,minionTriggerNameArray,minionAuraNameArray,damageSound,dieSound,skillAnimation_1,skillAnimation_2,skillAnimation_3,ballAnimation_1,ballAnimation_2,ballAnimation_3,hitAnimation_1,hitAnimation_2,hitAnimation_3,extraAnimation_1,extraAnimation_2,extraAnimation_3,skillSound_1,skillSound_2,skillSound_3,hitSound_1,hitSound_2,hitSound_3,extraSound_1,extraSound_2,extraSound_3
```

### 실제 데이터 입력 예시

**스킬 카드 예시 (FireBolt):**
```csv
FireBolt,Skill,Magician,Classic,Common,,,,,3,,,,,,,,,"[""FireBolt""]",,,,,,fire_skill_animation_1,,,fire_ball_1,,,fire_hit_1,,,,,fire_skill_sound_1,,,fire_hit_sound_1,,,,,
```

**미니언 카드 예시 (GoblinWarrior):**
```csv
GoblinWarrior,Minion,Warrior,Classic,Normal,,,,,2,3,2,,,,,,,"[""GoblinWarrior""]",,"[""GoblinWarrior""]",,goblin_damage,goblin_die,,,,,,,goblin_hit,,,,,,,goblin_hurt,,,,,
```

### 필드별 세부 가이드

**기본 정보 필드:**
- `name`: 카드 고유 이름 (영어, 공백 없음)
- `category`: "Skill" 또는 "Minion"
- `class`: "Warrior", "Magician", "Bowman", "Thief", "Pirate", "Common"
- `theme`: 카드 세트 테마
- `rarity`: "Normal", "Rare", "Epic", "Unique", "Legendary"

**게임플레이 필드:**
- `cost`: MP 비용 (0~10)
- `maxHp`: 미니언 최대 체력 (미니언만)
- `atk`: 미니언 공격력 (미니언만)

**트리거 및 오라:**
- `cardTriggerNameArray`: 카드 효과 트리거 배열 `["TriggerName"]`
- `minionTriggerNameArray`: 미니언 효과 트리거 배열 `["TriggerName"]`

**리소스 ID 필드:**
- `skillAnimation_1~3`: 스킬 애니메이션 리소스 ID
- `skillSound_1~3`: 스킬 사운드 리소스 ID
- 기타 애니메이션과 사운드 리소스 ID들

## 3단계: 트리거 효과 구현

### TriggerManager에 효과 추가

새 카드에 특별한 효과가 있다면 `TriggerManager.mlua`에 트리거 메서드를 추가해야 합니다.

**스킬 카드 트리거 구현**:
- `TriggerManager.mlua :: FireBolt()` — 스킬 효과 실행
- `TriggerManager.mlua :: FireBoltCondition()` — 발동 조건 검사

**미니언 트리거 예시:**
```lua
method void GoblinWarrior(Minion invoker, Minion receiver)
    self.taskManager:RunProcess(function()
        -- 죽을 때 모든 적 미니언에게 1 데미지
        if receiver == invoker then
            local enemies = invoker.player.opponent.field:GetMinions(nil)
            self.taskManager:Damage(enemies, invoker, 1, nil, "GoblinWarrior", nil)
        end
    end, "GoblinWarrior")
end

method boolean GoblinWarriorCondition(string triggerKey, Minion invoker, Minion receiver)
    return triggerKey == "Death" and invoker == receiver
end
```

### 주요 트리거 키

- **"Cast"**: 카드 시전 시
- **"Summon"**: 미니언 소환 시  
- **"Death"**: 유닛 사망 시
- **"BeginTurn"**: 턴 시작 시
- **"EndTurn"**: 턴 종료 시
- **"Attack"**: 공격 시
- **"BeforeAttack"**: 공격 전
- **"AfterAttack"**: 공격 후

## 4단계: 시각적 리소스 준비

### 카드 모델 생성

**필요한 모델들:**
```
CardFront 모델: [CardName]DefaultSilverCardFront
                [CardName]DefaultGoldCardFront
CardBack 모델:  [CardName]DefaultSilverCardBack  
                [CardName]DefaultGoldCardBack
Thumbnail:      [CardName]Default (썸네일용)
```

**변형(Variant) 지원:**
```
기본: [CardName]Default[Quality]CardFront
변형: [CardName][VariantName][Quality]CardFront
예: FireBoltHanbokSilverCardFront
```

### 애니메이션 및 이펙트

**스킬 카드 애니메이션:**
- `skillAnimation_1~3`: 스킬 시전 애니메이션
- `ballAnimation_1~3`: 투사체 애니메이션
- `hitAnimation_1~3`: 피격 이펙트

**미니언 애니메이션:**
- `damageSound`: 피해 사운드
- `dieSound`: 사망 사운드
- `hitAnimation_1~3`: 피격 이펙트

### 리소스 등록

**ResourceManager 업데이트:**
새 카드의 리소스들을 `ResourceManager.mlua`에 등록해야 합니다.

## 5단계: UI 및 로컬라이제이션

### 카드명 로컬라이제이션

**다국어 지원:**
```
한국어: "FireBolt" -> "파이어 볼트"
영어: "FireBolt" -> "Fire Bolt"
일본어: "FireBolt" -> "ファイアボルト"
```

### 카드 설명 추가

카드 효과 설명을 각 언어별로 추가해야 합니다.

## 6단계: AI 봇 연동

### ScoreManager 점수 추가

봇이 새 카드를 평가할 수 있도록 `ScoreManager.mlua`에 점수 로직을 추가합니다.

```lua
method number GetCardScore(Card card, Player player)
    local cardName = card.name
    
    if cardName == "FireBolt" then
        return 4.0  -- 기본 점수 + 상황별 보정
    elseif cardName == "GoblinWarrior" then
        return 5.5  -- 미니언 기본 점수
    end
    
    -- 기본 점수 로직...
end
```

### BotManager 덱 구성

봇의 기본 덱에 새 카드를 포함시키려면 `BotManager.mlua`를 업데이트합니다.

## 7단계: 테스트

### 기능 테스트

**체크리스트:**
- [ ] 카드가 정상적으로 로드되는가?
- [ ] 카드 시각적 표현이 올바른가?
- [ ] 카드 효과가 의도대로 작동하는가?
- [ ] 애니메이션과 사운드가 재생되는가?
- [ ] 봇이 카드를 적절히 사용하는가?

### 밸런스 테스트

**확인 사항:**
- [ ] 비용 대비 효과가 적절한가?
- [ ] 기존 카드들과의 밸런스가 맞는가?
- [ ] 게임 메타에 과도한 영향을 주지 않는가?

### 버그 테스트

**일반적인 버그들:**
- 트리거 조건 오류
- 애니메이션 타이밍 문제
- 리소스 로딩 실패
- 다국어 표시 오류

## 실전 예시: "힐링 포션" 카드 추가

### 1단계: 기획
```
카드명: HealingPotion
카테고리: Skill
직업: Common
테마: Classic
희귀도: Normal
비용: 2 MP
효과: 아군 유닛 하나의 체력을 3 회복
```

### 2단계: CSV 데이터
```csv
HealingPotion,Skill,Common,Classic,Normal,,,,,2,,,,,,,,,,"[""HealingPotion""]",,,,,,healing_animation,,,healing_ball,,,healing_effect,,,,,healing_sound,,,healing_hit,,,,,
```

### 3단계: 트리거 구현
```lua
method void HealingPotion(Card invoker, Card receiver, table result, Unit target)
    self.taskManager:RunProcess(function()
        if isvalid(target) and target.player == receiver.player then
            self.taskManager:Heal({target}, receiver, 3, nil, "HealingPotion", nil)
        end
    end, "HealingPotion")
end

method boolean HealingPotionCondition(string triggerKey, Card invoker, Card receiver)
    return triggerKey == "Cast" and invoker == receiver
end
```

### 4단계: 리소스 준비
- `HealingPotionDefaultSilverCardFront.model`
- `HealingPotionDefaultGoldCardFront.model`
- 힐링 애니메이션 및 사운드 파일들

## 고급 기능

### 조건부 효과

```lua
method void AdvancedCard(Card invoker, Card receiver)
    self.taskManager:RunProcess(function()
        local player = receiver.player
        local handCount = player.hand:GetCardCount()
        
        if handCount >= 5 then
            -- 손패가 5장 이상일 때 강화된 효과
            self.taskManager:Damage(enemies, receiver, 8, nil, "AdvancedCard", nil)
        else
            -- 기본 효과
            self.taskManager:Damage(enemies, receiver, 4, nil, "AdvancedCard", nil)
        end
    end, "AdvancedCard")
end
```

### 연쇄 효과

```lua
method void ChainCard(Card invoker, Card receiver)
    self.taskManager:RunProcess(function()
        -- 첫 번째 효과
        self.taskManager:Damage(targets, receiver, 2, nil, "ChainCard", nil)
        
        -- 추가 트리거 발생
        self:InvokeTriggers({receiver}, {receiver.player}, "ChainEffect", {}, nil, nil)
    end, "ChainCard")
end
```

## 주의사항

### 성능 고려사항
- 복잡한 트리거는 게임 성능에 영향을 줄 수 있음
- 무한 루프나 과도한 연쇄 효과 방지
- 리소스 크기 최적화

### 밸런스 고려사항
- 비용 대비 효과의 적절성
- 기존 카드와의 상호작용
- 메타게임에 미치는 영향

### 호환성 고려사항
- 기존 세이브 파일과의 호환성
- 다국어 지원
- 다양한 플랫폼에서의 동작

## 참고 자료

- `1. 핵심 아키텍처/카드 시스템/` - 카드 시스템 상세 문서
- `1. 핵심 아키텍처/매니저 시스템/` - 매니저 시스템 문서
- `2. 구현 세부사항/이벤트 시스템/트리거 시스템.md` - 트리거 시스템 문서

이 가이드를 따라 새로운 카드를 추가하면, 메이플 듀얼의 전체 시스템과 일관성 있게 통합되는 고품질의 카드를 만들 수 있습니다.
