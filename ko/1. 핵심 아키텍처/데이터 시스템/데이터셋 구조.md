# ë°ì´í„°ì…‹ êµ¬ì¡°

## ğŸ“‹ ê°œìš”

ë©”ì´í”Œ ë“€ì–¼ì€ CSV ê¸°ë°˜ì˜ ê°•ë ¥í•œ ë°ì´í„° ê´€ë¦¬ ì‹œìŠ¤í…œì„ í†µí•´ ì¹´ë“œ, ë±, ì¹´ë“œíŒ© ë“±ì˜ ë³µì¡í•œ ê²Œì„ ë°ì´í„°ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ê´€ë¦¬í•©ë‹ˆë‹¤. _DataServiceëŠ” MapleStory Worlds í”Œë«í¼ì˜ ë‚´ì¥ ì„œë¹„ìŠ¤ë¡œ, CSV íŒŒì¼ì„ UserDataSet ê°ì²´ë¡œ ë¡œë”©í•˜ì—¬ êµ¬ì¡°í™”ëœ ë°ì´í„° ì ‘ê·¼ì„ ì œê³µí•©ë‹ˆë‹¤. ì´ ì‹œìŠ¤í…œì„ í†µí•´ 266ê°œì˜ ì¹´ë“œì™€ 50ì—¬ ê°œì˜ ì†ì„±, ë‹¤ì–‘í•œ ì¹´ë“œíŒ©ê³¼ ë± êµ¬ì„± ë°ì´í„°ë¥¼ ì²´ê³„ì ìœ¼ë¡œ ê´€ë¦¬í•˜ë©°, ëŸ°íƒ€ì„ì—ì„œ ë¹ ë¥¸ ë°ì´í„° ì¡°íšŒì™€ í•„í„°ë§ì„ ê°€ëŠ¥í•˜ê²Œ í•©ë‹ˆë‹¤.

**ê´€ë ¨ íŒŒì¼**:
- `Environment/NativeScripts/Service/DataService.d.mlua` - _DataService API ì •ì˜
- `RootDesk/MyDesk/DataSets/Card.csv` - ì¹´ë“œ ë§ˆìŠ¤í„° ë°ì´í„°
- `RootDesk/MyDesk/DataSets/Deck.csv` - ë± ê´€ë ¨ ë°ì´í„°
- `RootDesk/MyDesk/DataSets/CardPack.csv` - ì¹´ë“œíŒ© ì‹œìŠ¤í…œ ë°ì´í„°

## ğŸ—ï¸ ë°ì´í„°ì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜

### _DataService ê¸°ë³¸ êµ¬ì¡°

```mermaid
graph TB
    A[CSV íŒŒì¼<br/>Card.csv, Deck.csv] --> B[_DataService]
    B --> C[GetTable name]
    C --> D[UserDataSet ê°ì²´]
    
    D --> E[ë°ì´í„° ì ‘ê·¼ ë©”ì„œë“œ]
    E --> F[GetColumn columnName]
    E --> G[FindRow key, value]
    E --> H[GetRow rowName]
    
    F --> I[ì—´ ì „ì²´ ë°ì´í„°]
    G --> J[ì¡°ê±´ ë§Œì¡± í–‰]
    H --> K[íŠ¹ì • í–‰ ë°ì´í„°]
    
    I --> L[ë§¤ë‹ˆì € í´ë˜ìŠ¤ì—ì„œ í™œìš©]
    J --> L
    K --> L
    
    style B fill:#ffcccc
    style D fill:#ccffcc
    style L fill:#ffffcc
```

## ğŸ”Œ 1. _DataService API í™œìš©

### í•µì‹¬ ë©”ì„œë“œ êµ¬ì¡°

#### ê¸°ë³¸ ë°ì´í„° ì ‘ê·¼
```lua
-- DataService API ì •ì˜ (Environment/NativeScripts/Service/DataService.d.mlua)
@Service
script DataService extends Service
    -- CSV íŒŒì¼ì„ UserDataSetìœ¼ë¡œ ë¡œë”©
    method UserDataSet GetTable(string name) end
    
    -- íŠ¹ì • ì…€ ë°ì´í„° ì¡°íšŒ (í–‰/ì—´ ì¸ë±ìŠ¤)
    method string GetCell(string name, int32 row, int32 col) end
    
    -- íŠ¹ì • ì…€ ë°ì´í„° ì¡°íšŒ (í–‰ ì¸ë±ìŠ¤/ì—´ ì´ë¦„)
    method string GetCell(string name, int32 row, string columnName) end
    
    -- ë°ì´í„°ì…‹ì˜ ì´ í–‰ ìˆ˜
    method int32 GetRowCount(string name) end
end
```

#### ì‹¤ì œ ì‚¬ìš© ì˜ˆì‹œ
```lua
-- CardManagerì—ì„œ Card.csv ë¡œë”©
method void OnBeginPlay()
    self.dataSet = _DataService:GetTable("Card")  -- Card.csv ë¡œë”©
    self.allCardNameArray = self.dataSet:GetColumn("name")  -- name ì—´ ì „ì²´ ì¡°íšŒ
    
    -- ì¹´ë“œë³„ ë¶„ë¥˜ í…Œì´ë¸” ìƒì„±
    for _, name in ipairs(self.allCardNameArray) do
        local class = self.dataSet:GetRow(name).class
        local category = self.dataSet:GetRow(name).category
        
        -- ì§ì—…ë³„ ë¶„ë¥˜
        self.classCardNameTable[class] = self.classCardNameTable[class] or {}
        table.insert(self.classCardNameTable[class], name)
    end
end
```

### UserDataSet ê°ì²´ í™œìš©

#### ë°ì´í„°ì…‹ íƒìƒ‰ ë©”ì„œë“œ
```lua
-- ì „ì²´ ì—´ ë°ì´í„° ì¡°íšŒ
local allCardNames = dataSet:GetColumn("name")
local allClasses = dataSet:GetColumn("class")
local allRarities = dataSet:GetColumn("rarity")

-- íŠ¹ì • í–‰ ë°ì´í„° ì¡°íšŒ
local cardRow = dataSet:GetRow("AirStrike")
local cost = cardRow.cost
local category = cardRow.category

-- ì¡°ê±´ë¶€ í–‰ ê²€ìƒ‰
local foundRow = dataSet:FindRow("name", "AirStrike")
local theme = foundRow:GetItem("theme")
```

## ğŸ´ 2. Card.csv ë°ì´í„° êµ¬ì¡°

### ì¹´ë“œ ë§ˆìŠ¤í„° ë°ì´í„° ìŠ¤í‚¤ë§ˆ

#### ê¸°ë³¸ ì‹ë³„ ì •ë³´
```mermaid
graph TB
    A[Card.csv] --> B[ê¸°ë³¸ ì‹ë³„]
    A --> C[ê²Œì„í”Œë ˆì´ ìŠ¤íƒ¯]
    A --> D[ì‹œê°ì  ë¦¬ì†ŒìŠ¤]
    A --> E[íš¨ê³¼ ì‹œìŠ¤í…œ]
    
    B --> B1[name: ê³ ìœ  ì´ë¦„<br/>category: Minion/Skill<br/>class: ì§ì—… ë¶„ë¥˜<br/>theme: í…Œë§ˆ<br/>rarity: í¬ê·€ë„]
    
    C --> C1[cost: MP ë¹„ìš©<br/>maxHp: ìµœëŒ€ ì²´ë ¥<br/>atk: ê³µê²©ë ¥<br/>ìƒíƒœ í”Œë˜ê·¸ë“¤]
    
    D --> D1[9ì¢… ì• ë‹ˆë©”ì´ì…˜ ê²½ë¡œ<br/>9ì¢… ì‚¬ìš´ë“œ ê²½ë¡œ<br/>ì¹´ë“œ ì´ë¯¸ì§€ ê²½ë¡œ]
    
    E --> E1[cardTriggerNameArray<br/>minionTriggerNameArray<br/>cardAuraNameArray<br/>minionAuraNameArray]
```

#### ì¹´ë“œ ë°ì´í„° ì ‘ê·¼ íŒ¨í„´
```lua
-- CardManagerì˜ ì¹´ë“œ ì •ë³´ ì ‘ê·¼ìë“¤
method string GetClass(string name)
    return self.dataSet:GetRow(name).class
end

method integer GetCost(string name)  
    return tonumber(self.dataSet:GetRow(name).cost)
end

method boolean IsToken(string name)
    return self.dataSet:GetRow(name).isToken == "TRUE"
end

method table GetTags(string name)
    local tagString = self.dataSet:GetRow(name).tagArray
    return tagString and _String:Split(tagString, ",") or {}
end

-- ë¦¬ì†ŒìŠ¤ ê²½ë¡œ ì¡°íšŒ
method string GetSkillAnimation_1(string name)
    return self.dataSet:GetRow(name).skillAnimation_1
end

method string GetSkillSound_1(string name)
    return self.dataSet:GetRow(name).skillSound_1  
end
```

### ì¹´ë“œ ë¶„ë¥˜ ì‹œìŠ¤í…œ

#### ë‹¤ì°¨ì› ì¸ë±ì‹±
```lua
-- CardManagerì—ì„œ ë¶„ë¥˜ë³„ ì¸ë±ìŠ¤ í…Œì´ë¸” ìƒì„±
method void OnBeginPlay()
    -- ì§ì—…ë³„ ë¶„ë¥˜
    self.classCardNameTable = {}
    self.classMinionNameTable = {}
    self.classSkillNameTable = {}
    
    -- ë¹„ìš©ë³„ ë¶„ë¥˜
    self.costCardNameTable = {}
    self.costMinionNameTable = {}
    self.costSkillNameTable = {}
    
    -- íƒœê·¸ë³„ ë¶„ë¥˜
    self.tagCardNameTable = {}
    self.tagMinionNameTable = {}
    self.tagSkillNameTable = {}
    
    -- ëª¨ë“  ì¹´ë“œë¥¼ ìˆœíšŒí•˜ë©° ë¶„ë¥˜
    for _, name in ipairs(self.allCardNameArray) do
        local class = self:GetClass(name)
        local category = self:GetCategory(name) 
        local cost = self:GetCost(name)
        local tags = self:GetTags(name)
        
        -- ê° ë¶„ë¥˜ì— ì¹´ë“œ ì¶”ê°€
        self:InsertToClassification(name, class, category, cost, tags)
    end
end
```

## ğŸ“š 3. Deck.csv ë°ì´í„° êµ¬ì¡°

### ë± ê´€ë ¨ ë©”íƒ€ë°ì´í„°

#### ë± êµ¬ì„± ì§€ì› ë°ì´í„°
```lua
-- DeckManagerì—ì„œ Deck.csv í™œìš©
method void OnBeginPlay()
    self.dataSet = _DataService:GetTable("Deck")
    
    -- ë± ì´ë¦„ìš© í˜•ìš©ì‚¬ ë°°ì—´ ë¡œë”©
    self.adjectiveArray = self.dataSet:GetColumn("adjective")
end

-- ë± ì´ë¦„ ìë™ ìƒì„±
method table GetNewDeck(string class, string localeId)
    local adjective = self.adjectiveArray[_UtilLogic:RandomIntegerRange(1, #self.adjectiveArray)]
    local name = _LocalizationService:GetText(adjective) .. " " .. _LocalizationService:GetText(class)
    
    return {
        class = class,
        name = name,
        cardTable = {}
    }
end
```

**Deck.csv êµ¬ì¡°**:
- **adjective**: ë± ì´ë¦„ ìƒì„±ìš© í˜•ìš©ì‚¬ë“¤ ("Mighty", "Swift", "Wise" ë“±)
- **ë‹¤êµ­ì–´ ì§€ì›**: ë¡œì»¬ë¼ì´ì œì´ì…˜ í‚¤ë¡œ ê° ì–¸ì–´ë³„ ë²ˆì—­ ì œê³µ
- **ëœë¤ ìƒì„±**: í”Œë ˆì´ì–´ê°€ ìƒˆ ë± ìƒì„± ì‹œ ìë™ìœ¼ë¡œ í¥ë¯¸ë¡œìš´ ì´ë¦„ ë¶€ì—¬

## ğŸ’° 4. CardPack.csv ë°ì´í„° êµ¬ì¡°

### ì¹´ë“œíŒ© ê²½ì œ ì‹œìŠ¤í…œ ë°ì´í„°

#### ì¹´ë“œíŒ© ë§ˆìŠ¤í„° ë°ì´í„°
```lua
-- CardPackManagerì—ì„œ CardPack.csv í™œìš©
method void OnBeginPlay()
    self.dataSet = _DataService:GetTable("CardPack")
    
    -- í…Œë§ˆë³„ ì¹´ë“œíŒ© ë¶„ë¥˜
    for _, name in ipairs(self.dataSet:GetColumn("name")) do
        local theme = self:GetTheme(name)
        self.cardPackNameTable[theme] = self.cardPackNameTable[theme] or {}
        table.insert(self.cardPackNameTable[theme], name)
    end
end

-- ì¹´ë“œíŒ© ì†ì„± ì ‘ê·¼ìë“¤
method string GetTheme(string name)
    return self.dataSet:FindRow("name", name):GetItem("theme")
end

method string GetCurrency(string name)
    return self.dataSet:FindRow("name", name):GetItem("currency")  -- "Meso" or "WorldCoin"
end

method integer GetSingleMesoPrice(string name)
    return tonumber(self.dataSet:FindRow("name", name):GetItem("singleMesoPrice"))
end

method integer GetMultipleMesoPrice(string name)
    return tonumber(self.dataSet:FindRow("name", name):GetItem("multipleMesoPrice"))  
end
```

#### ì¹´ë“œíŒ© ê²½ì œ ëª¨ë¸
```mermaid
graph TB
    A[CardPack.csv] --> B[ê¸°ë³¸ ì •ë³´]
    A --> C[ê°€ê²© ì²´ê³„]
    A --> D[ë“œë ì‹œìŠ¤í…œ]
    
    B --> B1[name: ì¹´ë“œíŒ© ì´ë¦„<br/>theme: í…Œë§ˆ ë¶„ë¥˜<br/>quality: í’ˆì§ˆ ë“±ê¸‰<br/>rarity: í¬ê·€ë„ ë“±ê¸‰]
    
    C --> C1[currency: í™”í ì¢…ë¥˜<br/>singleMesoPrice: ë‹¨ì¼ ë©”ì†Œ ê°€ê²©<br/>multipleMesoPrice: ë¬¶ìŒ ë©”ì†Œ ê°€ê²©<br/>singleWorldCoinPrice: ë‹¨ì¼ ì›”ë“œì½”ì¸ ê°€ê²©<br/>multipleWorldCoinPrice: ë¬¶ìŒ ì›”ë“œì½”ì¸ ê°€ê²©]
    
    D --> D1[ë“œë í™•ë¥  í…Œì´ë¸”<br/>í…Œë§ˆë³„ ì¹´ë“œí’€<br/>í’ˆì§ˆë³„ ê°€ì¤‘ì¹˜]
```

### ì¹´ë“œíŒ© ë“œë ì‹œìŠ¤í…œ

#### í™•ë¥  ê¸°ë°˜ ì¹´ë“œ ìƒì„±
```lua
@ExecSpace("ServerOnly")
method table GetInfos(string cardPackName)
    local cardPackTheme = self:GetTheme(cardPackName)
    local cardPackQuality = self:GetQuality(cardPackName)
    local cardPackRarity = self:GetRarity(cardPackName)
    
    local infoArray = {}
    for i = 1, 5 do  -- ê° íŒ©ë§ˆë‹¤ 5ì¥ ì¹´ë“œ
        local name, variant, quality
        local value = _UtilLogic:RandomDouble()
        
        -- CSV ë°ì´í„° ê¸°ë°˜ í™•ë¥  ê³„ì‚°
        -- cardPackQualityì™€ cardPackRarityë¥¼ í™œìš©í•œ ë“œëë¥  ì¡°ì •
        -- cardPackThemeì— í•´ë‹¹í•˜ëŠ” ì¹´ë“œí’€ì—ì„œ ì„ íƒ
        
        table.insert(infoArray, {
            name = name,
            variant = variant, 
            quality = quality
        })
    end
    
    return infoArray
end
```

## ğŸ” 5. ê³ ê¸‰ ë°ì´í„° í™œìš© íŒ¨í„´

### ë™ì  ì¿¼ë¦¬ ì‹œìŠ¤í…œ

#### ë³µí•© ì¡°ê±´ ê²€ìƒ‰
```lua
-- íŠ¹ì • ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” ì¹´ë“œë“¤ ê²€ìƒ‰
method table FindCardsByCondition(function predicate)
    local results = {}
    
    for _, name in ipairs(self.allCardNameArray) do
        local cardRow = self.dataSet:GetRow(name)
        if predicate(cardRow) then
            table.insert(results, name)
        end
    end
    
    return results
end

-- ì‚¬ìš© ì˜ˆì‹œ: 3ì½”ìŠ¤íŠ¸ ì´í•˜ ì „ì‚¬ ë¯¸ë‹ˆì–¸ ê²€ìƒ‰
local affordableWarriorMinions = cardManager:FindCardsByCondition(function(row)
    return row.class == "Warrior" 
       and row.category == "Minion" 
       and tonumber(row.cost) <= 3
end)
```

#### ì§‘ê³„ ë° í†µê³„
```lua
-- ì§ì—…ë³„ ì¹´ë“œ í†µê³„
method table GetClassStatistics()
    local stats = {}
    
    for _, name in ipairs(self.allCardNameArray) do
        local class = self:GetClass(name)
        local category = self:GetCategory(name)
        
        stats[class] = stats[class] or {minions = 0, skills = 0, total = 0}
        stats[class][category == "Minion" and "minions" or "skills"] += 1
        stats[class].total += 1
    end
    
    return stats
end
```

### ë©”ëª¨ë¦¬ íš¨ìœ¨ì„± ìµœì í™”

#### ì§€ì—° ë¡œë”© íŒ¨í„´
```lua
-- ëª¨ë“  ì¹´ë“œ ì •ë³´ë¥¼ ë¯¸ë¦¬ ë©”ëª¨ë¦¬ì— ë¡œë”©í•˜ì§€ ì•Šê³  í•„ìš”ì‹œì—ë§Œ ì¡°íšŒ
method table GetCardInfo(string name)
    if not self.cardInfoCache[name] then
        local row = self.dataSet:GetRow(name)
        self.cardInfoCache[name] = {
            cost = tonumber(row.cost),
            maxHp = tonumber(row.maxHp),
            atk = tonumber(row.atk),
            -- ê¸°íƒ€ ìì£¼ ì‚¬ìš©ë˜ëŠ” ì†ì„±ë“¤ë§Œ ìºì‹±
        }
    end
    
    return self.cardInfoCache[name]
end
```

#### ì¸ë±ì‹±ì„ í†µí•œ ë¹ ë¥¸ ê²€ìƒ‰
```lua
-- ê²Œì„ ì‹œì‘ ì‹œ ìì£¼ ì‚¬ìš©ë˜ëŠ” ê²€ìƒ‰ íŒ¨í„´ë“¤ì„ ë¯¸ë¦¬ ì¸ë±ì‹±
method void BuildSearchIndices()
    -- ë¹„ìš©ë³„ ì¸ë±ìŠ¤
    for cost = 0, 14 do
        self.costIndex[cost] = self:FindCardsByCondition(function(row)
            return tonumber(row.cost) == cost
        end)
    end
    
    -- í¬ê·€ë„ë³„ ì¸ë±ìŠ¤
    for _, rarity in ipairs({"Normal", "Rare", "Epic", "Unique", "Legendary"}) do
        self.rarityIndex[rarity] = self:FindCardsByCondition(function(row)
            return row.rarity == rarity
        end)
    end
end
```

## ğŸš€ 6. ì„±ëŠ¥ ìµœì í™” ì „ëµ

### ë°ì´í„° ë¡œë”© ìµœì í™”

#### ë‹¨ê³„ë³„ ì´ˆê¸°í™”
```mermaid
sequenceDiagram
    participant GM as Game Start
    participant DS as _DataService
    participant CM as CardManager
    participant DM as DeckManager
    participant CPM as CardPackManager
    
    GM->>DS: ëª¨ë“  CSV íŒŒì¼ ë¡œë”©
    DS->>CM: Card.csv â†’ UserDataSet
    DS->>DM: Deck.csv â†’ UserDataSet
    DS->>CPM: CardPack.csv â†’ UserDataSet
    
    CM->>CM: ì¹´ë“œ ë¶„ë¥˜ ì¸ë±ìŠ¤ ìƒì„±
    DM->>DM: ë± ë©”íƒ€ë°ì´í„° ì¤€ë¹„
    CPM->>CPM: ì¹´ë“œíŒ© í…Œë§ˆ ë¶„ë¥˜
    
    Note over CM,CPM: ëª¨ë“  ë§¤ë‹ˆì €ê°€ ë³‘ë ¬ë¡œ ì´ˆê¸°í™”
```

### ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ìµœì í™”

#### ì„ íƒì  ë°ì´í„° ë¡œë”©
```lua
-- í´ë¼ì´ì–¸íŠ¸ì—ì„œëŠ” ì‹œê°ì  ë¦¬ì†ŒìŠ¤ë§Œ, ì„œë²„ì—ì„œëŠ” ê²Œì„ ë¡œì§ ë°ì´í„°ë§Œ ë¡œë”©
method void OnBeginPlay()
    self.dataSet = _DataService:GetTable("Card")
    
    if self:IsServer() then
        -- ì„œë²„ëŠ” ê²Œì„ ë¡œì§ ë°ì´í„°ë§Œ
        self:LoadGameplayData()
    else
        -- í´ë¼ì´ì–¸íŠ¸ëŠ” ì‹œê°ì  ë¦¬ì†ŒìŠ¤ë„
        self:LoadGameplayData()
        self:LoadVisualResources()
    end
end
```

## ğŸ’¡ ì½”ë“œ ì°¸ì¡°

ë°ì´í„°ì…‹ ì‹œìŠ¤í…œ í•µì‹¬ ë¡œì§:
- `CardManager.mlua :: OnBeginPlay()` â€” Card.csv ë¡œë”© ë° ë¶„ë¥˜ ì¸ë±ìŠ¤ ìƒì„±
- `DeckManager.mlua :: OnBeginPlay()` â€” Deck.csv ë©”íƒ€ë°ì´í„° ë¡œë”©
- `CardPackManager.mlua :: GetInfos()` â€” ì„œë²„ ì¸¡ ì¹´ë“œíŒ© ë“œë ë¡œì§
- `DataService.d.mlua :: GetTable()` â€” CSV íŒŒì¼ì„ UserDataSetìœ¼ë¡œ ë³€í™˜
- `EntryManager.mlua :: OnBeginPlay()` â€” ê²Œì„ ê°ì²´ ê¸°ë³¸ê°’ ë§¤í•‘

ë°ì´í„°ì…‹ êµ¬ì¡°ëŠ” ë©”ì´í”Œ ë“€ì–¼ì˜ ë³µì¡í•œ ì¹´ë“œ ê²Œì„ ë°ì´í„°ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ê´€ë¦¬í•˜ëŠ” í•µì‹¬ ì‹œìŠ¤í…œìœ¼ë¡œ, CSV ê¸°ë°˜ì˜ êµ¬ì¡°í™”ëœ ë°ì´í„°ì™€ _DataServiceì˜ ê°•ë ¥í•œ ì¿¼ë¦¬ ê¸°ëŠ¥ì„ í†µí•´ ê°œë°œ ìƒì‚°ì„±ê³¼ ëŸ°íƒ€ì„ ì„±ëŠ¥ì„ ë™ì‹œì— ë‹¬ì„±í•©ë‹ˆë‹¤.
